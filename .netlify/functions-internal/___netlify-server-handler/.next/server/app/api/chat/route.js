(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:a=>{"use strict";a.exports=require("punycode")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:a=>{"use strict";a.exports=require("stream")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48152:(a,b,c)=>{"use strict";c.d(b,{d:()=>f});var d=c(26873),e=c(86802);let f=async()=>{let a=await (0,e.UL)();return(0,d.createServerClient)("https://nugjghwkvfkdbgrgsazv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51Z2pnaHdrdmZrZGJncmdzYXp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MjM3NzMsImV4cCI6MjA3MzQ5OTc3M30.6iaRtFDTdss9YgKaPYnP63A1TC2FNqN4ywPlRnrrssA",{cookies:{get:b=>a.get(b)?.value,set(b,c,d){try{a.set({name:b,value:c,...d})}catch(a){}},remove(b,c){try{a.set({name:b,value:"",...c})}catch(a){}}}})}},50800:(a,b,c)=>{"use strict";let d,e,f;c.r(b),c.d(b,{handler:()=>b8,patchFetch:()=>b7,routeModule:()=>b3,serverHooks:()=>b6,workAsyncStorage:()=>b4,workUnitAsyncStorage:()=>b5});var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af={};c.r(af),c.d(af,{POST:()=>b2});var ag=c(95736),ah=c(9117),ai=c(4044),aj=c(39326),ak=c(32324),al=c(261),am=c(54290),an=c(85328),ao=c(38928),ap=c(46595),aq=c(3421),ar=c(17679),as=c(41681),at=c(63446),au=c(86439),av=c(51356),aw=c(10641),ax=c(48152);function ay(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function az(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}let aA=function(){let{crypto:a}=globalThis;if(a?.randomUUID)return aA=a.randomUUID.bind(a),a.randomUUID();let b=new Uint8Array(1),c=a?()=>a.getRandomValues(b)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^c()&15>>a/4).toString(16))};function aB(a){return"object"==typeof a&&null!==a&&("name"in a&&"AbortError"===a.name||"message"in a&&String(a.message).includes("FetchRequestCanceledException"))}let aC=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a){try{if("[object Error]"===Object.prototype.toString.call(a)){let b=Error(a.message,a.cause?{cause:a.cause}:{});return a.stack&&(b.stack=a.stack),a.cause&&!b.cause&&(b.cause=a.cause),a.name&&(b.name=a.name),b}}catch{}try{return Error(JSON.stringify(a))}catch{}}return Error(a)};class aD extends Error{}class aE extends aD{constructor(a,b,c,d){super(`${aE.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.requestID=d?.get("request-id"),this.error=b}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){return a&&d?400===a?new aI(a,b,c,d):401===a?new aJ(a,b,c,d):403===a?new aK(a,b,c,d):404===a?new aL(a,b,c,d):409===a?new aM(a,b,c,d):422===a?new aN(a,b,c,d):429===a?new aO(a,b,c,d):a>=500?new aP(a,b,c,d):new aE(a,b,c,d):new aG({message:c,cause:aC(b)})}}class aF extends aE{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class aG extends aE{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class aH extends aG{constructor({message:a}={}){super({message:a??"Request timed out."})}}class aI extends aE{}class aJ extends aE{}class aK extends aE{}class aL extends aE{}class aM extends aE{}class aN extends aE{}class aO extends aE{}class aP extends aE{}let aQ=/^[a-z][a-z0-9+.-]*:/i,aR=a=>(aR=Array.isArray)(a),aS=aR;function aT(a){return"object"!=typeof a?{}:a??{}}let aU=a=>{try{return JSON.parse(a)}catch(a){return}},aV="0.62.0",aW=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",aX=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown";function aY(...a){let b=globalThis.ReadableStream;if(void 0===b)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new b(...a)}function aZ(a){let b=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a[Symbol.iterator]();return aY({start(){},async pull(a){let{done:c,value:d}=await b.next();c?a.close():a.enqueue(d)},async cancel(){await b.return?.()}})}function a$(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function a_(a){if(null===a||"object"!=typeof a)return;if(a[Symbol.asyncIterator])return void await a[Symbol.asyncIterator]().return?.();let b=a.getReader(),c=b.cancel();b.releaseLock(),await c}let a0=({headers:a,body:b})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(b)});function a1(a){let b;return(e??(e=(b=new globalThis.TextEncoder).encode.bind(b)))(a)}function a2(a){let b;return(f??(f=(b=new globalThis.TextDecoder).decode.bind(b)))(a)}class a3{constructor(){g.set(this,void 0),h.set(this,void 0),ay(this,g,new Uint8Array,"f"),ay(this,h,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?a1(a):a;ay(this,g,function(a){let b=0;for(let c of a)b+=c.length;let c=new Uint8Array(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return c}([az(this,g,"f"),c]),"f");let d=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(az(this,g,"f"),az(this,h,"f")));){if(b.carriage&&null==az(this,h,"f")){ay(this,h,b.index,"f");continue}if(null!=az(this,h,"f")&&(b.index!==az(this,h,"f")+1||b.carriage)){d.push(a2(az(this,g,"f").subarray(0,az(this,h,"f")-1))),ay(this,g,az(this,g,"f").subarray(az(this,h,"f")),"f"),ay(this,h,null,"f");continue}let a=null!==az(this,h,"f")?b.preceding-1:b.preceding,c=a2(az(this,g,"f").subarray(0,a));d.push(c),ay(this,g,az(this,g,"f").subarray(b.index),"f"),ay(this,h,null,"f")}return d}flush(){return az(this,g,"f").length?this.decode("\n"):[]}}g=new WeakMap,h=new WeakMap,a3.NEWLINE_CHARS=new Set(["\n","\r"]),a3.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let a4={off:0,error:200,warn:300,info:400,debug:500},a5=(a,b,c)=>{if(a){if(Object.prototype.hasOwnProperty.call(a4,a))return a;ba(c).warn(`${b} was set to ${JSON.stringify(a)}, expected one of ${JSON.stringify(Object.keys(a4))}`)}};function a6(){}function a7(a,b,c){return!b||a4[a]>a4[c]?a6:b[a].bind(b)}let a8={error:a6,warn:a6,info:a6,debug:a6},a9=new WeakMap;function ba(a){let b=a.logger,c=a.logLevel??"off";if(!b)return a8;let d=a9.get(b);if(d&&d[0]===c)return d[1];let e={error:a7("error",b,c),warn:a7("warn",b,c),info:a7("info",b,c),debug:a7("debug",b,c)};return a9.set(b,[c,e]),e}let bb=a=>(a.options&&(a.options={...a.options},delete a.options.headers),a.headers&&(a.headers=Object.fromEntries((a.headers instanceof Headers?[...a.headers]:Object.entries(a.headers)).map(([a,b])=>[a,"x-api-key"===a.toLowerCase()||"authorization"===a.toLowerCase()||"cookie"===a.toLowerCase()||"set-cookie"===a.toLowerCase()?"***":b]))),"retryOfRequestLogID"in a&&(a.retryOfRequestLogID&&(a.retryOf=a.retryOfRequestLogID),delete a.retryOfRequestLogID),a);class bc{constructor(a,b,c){this.iterator=a,i.set(this,void 0),this.controller=b,ay(this,i,c,"f")}static fromSSEResponse(a,b,c){let d=!1,e=c?ba(c):console;async function*f(){if(d)throw new aD("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let c=!1;try{for await(let c of bd(a,b)){if("completion"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("message_start"===c.event||"message_delta"===c.event||"message_stop"===c.event||"content_block_start"===c.event||"content_block_delta"===c.event||"content_block_stop"===c.event)try{yield JSON.parse(c.data)}catch(a){throw e.error("Could not parse message into JSON:",c.data),e.error("From chunk:",c.raw),a}if("ping"!==c.event&&"error"===c.event)throw new aE(void 0,aU(c.data)??c.data,void 0,a.headers)}c=!0}catch(a){if(aB(a))return;throw a}finally{c||b.abort()}}return new bc(f,b,c)}static fromReadableStream(a,b,c){let d=!1;async function*e(){let b=new a3;for await(let c of a$(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new bc(async function*(){if(d)throw new aD("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");d=!0;let a=!1;try{for await(let b of e())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(aB(a))return;throw a}finally{a||b.abort()}},b,c)}[(i=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new bc(()=>d(a),this.controller,az(this,i,"f")),new bc(()=>d(b),this.controller,az(this,i,"f"))]}toReadableStream(){let a,b=this;return aY({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:c,done:d}=await a.next();if(d)return b.close();let e=a1(JSON.stringify(c)+"\n");b.enqueue(e)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*bd(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aD("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aD("Attempted to iterate over a response with no body")}let c=new bf,d=new a3;for await(let b of be(a$(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*be(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?a1(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class bf{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}async function bg(a,b){let{response:c,requestLogID:d,retryOfRequestLogID:e,startTime:f}=b,g=await (async()=>{if(b.options.stream)return(ba(a).debug("response",c.status,c.url,c.headers,c.body),b.options.__streamClass)?b.options.__streamClass.fromSSEResponse(c,b.controller):bc.fromSSEResponse(c,b.controller);if(204===c.status)return null;if(b.options.__binaryResponse)return c;let d=c.headers.get("content-type"),e=d?.split(";")[0]?.trim();return e?.includes("application/json")||e?.endsWith("+json")?bh(await c.json(),c):await c.text()})();return ba(a).debug(`[${d}] response parsed`,bb({retryOfRequestLogID:e,url:c.url,status:c.status,body:g,durationMs:Date.now()-f})),g}function bh(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("request-id"),enumerable:!1})}class bi extends Promise{constructor(a,b,c=bg){super(a=>{a(null)}),this.responsePromise=b,this.parseResponse=c,j.set(this,void 0),ay(this,j,a,"f")}_thenUnwrap(a){return new bi(az(this,j,"f"),this.responsePromise,async(b,c)=>bh(a(await this.parseResponse(b,c),c),c.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(az(this,j,"f"),a))),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}j=new WeakMap;class bj{constructor(a,b,c,d){k.set(this,void 0),ay(this,k,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let a=this.nextPageRequestOptions();if(!a)throw new aD("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await az(this,k,"f").requestAPIList(this.constructor,a)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(k=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class bk extends bi{constructor(a,b,c){super(a,b,async(a,b)=>new c(a,b.response,await bg(a,b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}class bl extends bj{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1,this.first_id=c.first_id||null,this.last_id=c.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let a=this.first_id;return a?{...this.options,query:{...aT(this.options.query),before_id:a}}:null}let a=this.last_id;return a?{...this.options,query:{...aT(this.options.query),after_id:a}}:null}}let bm=()=>{if("undefined"==typeof File){let{process:a}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof a?.versions?.node&&20>parseInt(a.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function bn(a,b,c){return bm(),new File(a,b??"unknown_file",c)}function bo(a){return("object"==typeof a&&null!==a&&("name"in a&&a.name&&String(a.name)||"url"in a&&a.url&&String(a.url)||"filename"in a&&a.filename&&String(a.filename)||"path"in a&&a.path&&String(a.path))||"").split(/[\\/]/).pop()||void 0}let bp=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],bq=async(a,b)=>({...a,body:await bs(a.body,b)}),br=new WeakMap,bs=async(a,b)=>{if(!await function(a){let b="function"==typeof a?a:a.fetch,c=br.get(b);if(c)return c;let d=(async()=>{try{let a="Response"in b?b.Response:(await b("data:,")).constructor,c=new FormData;if(c.toString()===await new a(c).text())return!1;return!0}catch{return!0}})();return br.set(b,d),d}(b))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let c=new FormData;return await Promise.all(Object.entries(a||{}).map(([a,b])=>bv(c,a,b))),c},bt=a=>a instanceof Blob&&"name"in a,bu=a=>{if((a=>"object"==typeof a&&null!==a&&(a instanceof Response||bp(a)||bt(a)))(a))return!0;if(Array.isArray(a))return a.some(bu);if(a&&"object"==typeof a){for(let b in a)if(bu(a[b]))return!0}return!1},bv=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(c instanceof Response){let d={},e=c.headers.get("Content-Type");e&&(d={type:e}),a.append(b,bn([await c.blob()],bo(c),d))}else if(bp(c))a.append(b,bn([await new Response(aZ(c)).blob()],bo(c)));else if(bt(c))a.append(b,bn([c],bo(c),{type:c.type}));else if(Array.isArray(c))await Promise.all(c.map(c=>bv(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>bv(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}},bw=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer;async function bx(a,b,c){let d,e;if(bm(),a=await a,b||(b=bo(a)),null!=(d=a)&&"object"==typeof d&&"string"==typeof d.name&&"number"==typeof d.lastModified&&bw(d))return a instanceof File&&null==b&&null==c?a:bn([await a.arrayBuffer()],b??a.name,{type:a.type,lastModified:a.lastModified,...c});if(null!=(e=a)&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob){let d=await a.blob();return b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()),bn(await by(d),b,c)}let f=await by(a);if(!c?.type){let a=f.find(a=>"object"==typeof a&&"type"in a&&a.type);"string"==typeof a&&(c={...c,type:a})}return bn(f,b,c)}async function by(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(bw(a))b.push(a instanceof Blob?a:await a.arrayBuffer());else if(bp(a))for await(let c of a)b.push(...await by(c));else{let b=a?.constructor?.name;throw Error(`Unexpected data type: ${typeof a}${b?`; constructor: ${b}`:""}${function(a){if("object"!=typeof a||null===a)return"";let b=Object.getOwnPropertyNames(a);return`; props: [${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`)}return b}class bz{constructor(a){this._client=a}}let bA=Symbol.for("brand.privateNullableHeaders"),bB=a=>{let b=new Headers,c=new Set;for(let d of a){let a=new Set;for(let[e,f]of function*(a){let b;if(!a)return;if(bA in a){let{values:b,nulls:c}=a;for(let a of(yield*b.entries(),c))yield[a,null];return}let c=!1;for(let d of(a instanceof Headers?b=a.entries():aS(a)?b=a:(c=!0,b=Object.entries(a??{})),b)){let a=d[0];if("string"!=typeof a)throw TypeError("expected header name to be a string");let b=aS(d[1])?d[1]:[d[1]],e=!1;for(let d of b)void 0!==d&&(c&&!e&&(e=!0,yield[a,null]),yield[a,d])}}(d)){let d=e.toLowerCase();a.has(d)||(b.delete(e),a.add(d)),null===f?(b.delete(e),c.add(d)):(b.append(e,f),c.delete(d))}}return{[bA]:!0,values:b,nulls:c}};function bC(a){return a.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let bD=Object.freeze(Object.create(null)),bE=((a=bC)=>function(b,...c){let d;if(1===b.length)return b[0];let e=!1,f=[],g=b.reduce((b,d,g)=>{/[?#]/.test(d)&&(e=!0);let h=c[g],i=(e?encodeURIComponent:a)(""+h);return g!==c.length&&(null==h||"object"==typeof h&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??bD)??bD)?.toString)&&(i=h+"",f.push({start:b.length+d.length,length:i.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),b+d+(g===c.length?"":i)},""),h=g.split(/[?#]/,1)[0],i=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(d=i.exec(h));)f.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(f.sort((a,b)=>a.start-b.start),f.length>0){let a=0,b=f.reduce((b,c)=>{let d=" ".repeat(c.start-a),e="^".repeat(c.length);return a=c.start+c.length,b+d+e},"");throw new aD(`Path parameters result in path with invalid segments:
${f.map(a=>a.error).join("\n")}
${g}
${b}`)}return g})(bC);class bF extends bz{list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/files",bl,{query:d,...b,headers:bB([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bE`/v1/files/${a}`,{...c,headers:bB([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}download(a,b={},c){let{betas:d}=b??{};return this._client.get(bE`/v1/files/${a}/content`,{...c,headers:bB([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},c?.headers]),__binaryResponse:!0})}retrieveMetadata(a,b={},c){let{betas:d}=b??{};return this._client.get(bE`/v1/files/${a}`,{...c,headers:bB([{"anthropic-beta":[...d??[],"files-api-2025-04-14"].toString()},c?.headers])})}upload(a,b){let{betas:c,...d}=a;return this._client.post("/v1/files",bq({body:d,...b,headers:bB([{"anthropic-beta":[...c??[],"files-api-2025-04-14"].toString()},b?.headers])},this._client))}}class bG extends bz{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bE`/v1/models/${a}?beta=true`,{...c,headers:bB([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models?beta=true",bl,{query:d,...b,headers:bB([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}class bH{constructor(a,b){this.iterator=a,this.controller=b}async *decoder(){let a=new a3;for await(let b of this.iterator)for(let c of a.decode(b))yield JSON.parse(c);for(let b of a.flush())yield JSON.parse(b)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(a,b){if(!a.body){if(b.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new aD("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new aD("Attempted to iterate over a response with no body")}return new bH(a$(a.body),b)}}class bI extends bz{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/batches?beta=true",{body:d,...b,headers:bB([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bE`/v1/messages/batches/${a}?beta=true`,{...c,headers:bB([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/messages/batches?beta=true",bl,{query:d,...b,headers:bB([{"anthropic-beta":[...c??[],"message-batches-2024-09-24"].toString()},b?.headers])})}delete(a,b={},c){let{betas:d}=b??{};return this._client.delete(bE`/v1/messages/batches/${a}?beta=true`,{...c,headers:bB([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}cancel(a,b={},c){let{betas:d}=b??{};return this._client.post(bE`/v1/messages/batches/${a}/cancel?beta=true`,{...c,headers:bB([{"anthropic-beta":[...d??[],"message-batches-2024-09-24"].toString()},c?.headers])})}async results(a,b={},c){let d=await this.retrieve(a);if(!d.results_url)throw new aD(`No batch \`results_url\`; Has it finished processing? ${d.processing_status} - ${d.id}`);let{betas:e}=b??{};return this._client.get(d.results_url,{...c,headers:bB([{"anthropic-beta":[...e??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},c?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>bH.fromResponse(b.response,b.controller))}}let bJ=a=>{if(0===a.length)return a;let b=a[a.length-1];switch(b.type){case"separator":return bJ(a=a.slice(0,a.length-1));case"number":let c=b.value[b.value.length-1];if("."===c||"-"===c)return bJ(a=a.slice(0,a.length-1));case"string":let d=a[a.length-2];if(d?.type==="delimiter"||d?.type==="brace"&&"{"===d.value)return bJ(a=a.slice(0,a.length-1));break;case"delimiter":return bJ(a=a.slice(0,a.length-1))}return a},bK=a=>JSON.parse((a=>{let b="";return a.map(a=>{"string"===a.type?b+='"'+a.value+'"':b+=a.value}),b})((a=>{let b=[];return a.map(a=>{"brace"===a.type&&("{"===a.value?b.push("}"):b.splice(b.lastIndexOf("}"),1)),"paren"===a.type&&("["===a.value?b.push("]"):b.splice(b.lastIndexOf("]"),1))}),b.length>0&&b.reverse().map(b=>{"}"===b?a.push({type:"brace",value:"}"}):"]"===b&&a.push({type:"paren",value:"]"})}),a})(bJ((a=>{let b=0,c=[];for(;b<a.length;){let d=a[b];if("\\"===d){b++;continue}if("{"===d){c.push({type:"brace",value:"{"}),b++;continue}if("}"===d){c.push({type:"brace",value:"}"}),b++;continue}if("["===d){c.push({type:"paren",value:"["}),b++;continue}if("]"===d){c.push({type:"paren",value:"]"}),b++;continue}if(":"===d){c.push({type:"separator",value:":"}),b++;continue}if(","===d){c.push({type:"delimiter",value:","}),b++;continue}if('"'===d){let e="",f=!1;for(d=a[++b];'"'!==d;){if(b===a.length){f=!0;break}if("\\"===d){if(++b===a.length){f=!0;break}e+=d+a[b],d=a[++b]}else e+=d,d=a[++b]}d=a[++b],f||c.push({type:"string",value:e});continue}let e=/\s/;if(d&&e.test(d)){b++;continue}let f=/[0-9]/;if(d&&f.test(d)||"-"===d||"."===d){let e="";for("-"===d&&(e+=d,d=a[++b]);d&&f.test(d)||"."===d;)e+=d,d=a[++b];c.push({type:"number",value:e});continue}let g=/[a-z]/i;if(d&&g.test(d)){let e="";for(;d&&g.test(d)&&b!==a.length;)e+=d,d=a[++b];"true"==e||"false"==e||"null"===e?c.push({type:"name",value:e}):b++;continue}b++}return c})(a))))),bL="__json_buf";function bM(a){return"tool_use"===a.type||"server_tool_use"===a.type||"mcp_tool_use"===a.type}class bN{constructor(){l.add(this),this.messages=[],this.receivedMessages=[],m.set(this,void 0),this.controller=new AbortController,n.set(this,void 0),o.set(this,()=>{}),p.set(this,()=>{}),q.set(this,void 0),r.set(this,()=>{}),s.set(this,()=>{}),t.set(this,{}),u.set(this,!1),v.set(this,!1),w.set(this,!1),x.set(this,!1),y.set(this,void 0),z.set(this,void 0),C.set(this,a=>{if(ay(this,v,!0,"f"),aB(a)&&(a=new aF),a instanceof aF)return ay(this,w,!0,"f"),this._emit("abort",a);if(a instanceof aD)return this._emit("error",a);if(a instanceof Error){let b=new aD(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aD(String(a)))}),ay(this,n,new Promise((a,b)=>{ay(this,o,a,"f"),ay(this,p,b,"f")}),"f"),ay(this,q,new Promise((a,b)=>{ay(this,r,a,"f"),ay(this,s,b,"f")}),"f"),az(this,n,"f").catch(()=>{}),az(this,q,"f").catch(()=>{})}get response(){return az(this,y,"f")}get request_id(){return az(this,z,"f")}async withResponse(){let a=await az(this,n,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new bN;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new bN;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},az(this,C,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{az(this,l,"m",D).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))az(this,l,"m",E).call(this,a);if(e.controller.signal?.aborted)throw new aF;az(this,l,"m",F).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(ay(this,y,a,"f"),ay(this,z,a?.headers.get("request-id"),"f"),az(this,o,"f").call(this,a),this._emit("connect"))}get ended(){return az(this,u,"f")}get errored(){return az(this,v,"f")}get aborted(){return az(this,w,"f")}abort(){this.controller.abort()}on(a,b){return(az(this,t,"f")[a]||(az(this,t,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=az(this,t,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(az(this,t,"f")[a]||(az(this,t,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{ay(this,x,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){ay(this,x,!0,"f"),await az(this,q,"f")}get currentMessage(){return az(this,m,"f")}async finalMessage(){return await this.done(),az(this,l,"m",A).call(this)}async finalText(){return await this.done(),az(this,l,"m",B).call(this)}_emit(a,...b){if(az(this,u,"f"))return;"end"===a&&(ay(this,u,!0,"f"),az(this,r,"f").call(this));let c=az(this,t,"f")[a];if(c&&(az(this,t,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];az(this,x,"f")||c?.length||Promise.reject(a),az(this,p,"f").call(this,a),az(this,s,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];az(this,x,"f")||c?.length||Promise.reject(a),az(this,p,"f").call(this,a),az(this,s,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",az(this,l,"m",A).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{az(this,l,"m",D).call(this),this._connected(null);let b=bc.fromReadableStream(a,this.controller);for await(let a of b)az(this,l,"m",E).call(this,a);if(b.controller.signal?.aborted)throw new aF;az(this,l,"m",F).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,z=new WeakMap,C=new WeakMap,l=new WeakSet,A=function(){if(0===this.receivedMessages.length)throw new aD("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},B=function(){if(0===this.receivedMessages.length)throw new aD("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aD("stream ended without producing a content block with type=text");return a.join(" ")},D=function(){this.ended||ay(this,m,void 0,"f")},E=function(a){if(this.ended)return;let b=az(this,l,"m",G).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":bM(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":ay(this,m,b,"f")}},F=function(){if(this.ended)throw new aD("stream has ended, this shouldn't happen");let a=az(this,m,"f");if(!a)throw new aD("request ended without sending any chunks");return ay(this,m,void 0,"f"),a},G=function(a){let b=az(this,m,"f");if("message_start"===a.type){if(b)throw new aD(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aD(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":case"content_block_stop":return b;case"message_delta":return b.container=a.delta.container,b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push(a.content_block),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&bM(c)){let d=c[bL]||"";d+=a.delta.partial_json;let e={...c};if(Object.defineProperty(e,bL,{value:d,enumerable:!1,writable:!0}),d)try{e.input=bK(d)}catch(b){let a=new aD(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${b}. JSON: ${d}`);az(this,C,"f").call(this,a)}b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bc(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let bO={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192},bP={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-5-sonnet-20241022":"October 22, 2025","claude-3-5-sonnet-20240620":"October 22, 2025"};class bQ extends bz{constructor(){super(...arguments),this.batches=new bI(this._client)}create(a,b){let{betas:c,...d}=a;d.model in bP&&console.warn(`The model '${d.model}' is deprecated and will reach end-of-life on ${bP[d.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let e=this._client._options.timeout;if(!d.stream&&null==e){let a=bO[d.model]??void 0;e=this._client.calculateNonstreamingTimeout(d.max_tokens,a)}return this._client.post("/v1/messages?beta=true",{body:d,timeout:e??6e5,...b,headers:bB([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}stream(a,b){return bN.createMessage(this,a,b)}countTokens(a,b){let{betas:c,...d}=a;return this._client.post("/v1/messages/count_tokens?beta=true",{body:d,...b,headers:bB([{"anthropic-beta":[...c??[],"token-counting-2024-11-01"].toString()},b?.headers])})}}bQ.Batches=bI;class bR extends bz{constructor(){super(...arguments),this.models=new bG(this._client),this.messages=new bQ(this._client),this.files=new bF(this._client)}}bR.Models=bG,bR.Messages=bQ,bR.Files=bF;class bS extends bz{create(a,b){let{betas:c,...d}=a;return this._client.post("/v1/complete",{body:d,timeout:this._client._options.timeout??6e5,...b,headers:bB([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers]),stream:a.stream??!1})}}let bT="__json_buf";function bU(a){return"tool_use"===a.type||"server_tool_use"===a.type}class bV{constructor(){H.add(this),this.messages=[],this.receivedMessages=[],I.set(this,void 0),this.controller=new AbortController,J.set(this,void 0),K.set(this,()=>{}),L.set(this,()=>{}),M.set(this,void 0),N.set(this,()=>{}),O.set(this,()=>{}),P.set(this,{}),Q.set(this,!1),R.set(this,!1),S.set(this,!1),T.set(this,!1),U.set(this,void 0),V.set(this,void 0),Y.set(this,a=>{if(ay(this,R,!0,"f"),aB(a)&&(a=new aF),a instanceof aF)return ay(this,S,!0,"f"),this._emit("abort",a);if(a instanceof aD)return this._emit("error",a);if(a instanceof Error){let b=new aD(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new aD(String(a)))}),ay(this,J,new Promise((a,b)=>{ay(this,K,a,"f"),ay(this,L,b,"f")}),"f"),ay(this,M,new Promise((a,b)=>{ay(this,N,a,"f"),ay(this,O,b,"f")}),"f"),az(this,J,"f").catch(()=>{}),az(this,M,"f").catch(()=>{})}get response(){return az(this,U,"f")}get request_id(){return az(this,V,"f")}async withResponse(){let a=await az(this,J,"f");if(!a)throw Error("Could not resolve a `Response` object");return{data:this,response:a,request_id:a.headers.get("request-id")}}static fromReadableStream(a){let b=new bV;return b._run(()=>b._fromReadableStream(a)),b}static createMessage(a,b,c){let d=new bV;for(let a of b.messages)d._addMessageParam(a);return d._run(()=>d._createMessage(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}_run(a){a().then(()=>{this._emitFinal(),this._emit("end")},az(this,Y,"f"))}_addMessageParam(a){this.messages.push(a)}_addMessage(a,b=!0){this.receivedMessages.push(a),b&&this._emit("message",a)}async _createMessage(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),d=this.controller.abort.bind(this.controller),e.addEventListener("abort",d));try{az(this,H,"m",Z).call(this);let{response:d,data:e}=await a.create({...b,stream:!0},{...c,signal:this.controller.signal}).withResponse();for await(let a of(this._connected(d),e))az(this,H,"m",$).call(this,a);if(e.controller.signal?.aborted)throw new aF;az(this,H,"m",_).call(this)}finally{e&&d&&e.removeEventListener("abort",d)}}_connected(a){this.ended||(ay(this,U,a,"f"),ay(this,V,a?.headers.get("request-id"),"f"),az(this,K,"f").call(this,a),this._emit("connect"))}get ended(){return az(this,Q,"f")}get errored(){return az(this,R,"f")}get aborted(){return az(this,S,"f")}abort(){this.controller.abort()}on(a,b){return(az(this,P,"f")[a]||(az(this,P,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=az(this,P,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(az(this,P,"f")[a]||(az(this,P,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{ay(this,T,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){ay(this,T,!0,"f"),await az(this,M,"f")}get currentMessage(){return az(this,I,"f")}async finalMessage(){return await this.done(),az(this,H,"m",W).call(this)}async finalText(){return await this.done(),az(this,H,"m",X).call(this)}_emit(a,...b){if(az(this,Q,"f"))return;"end"===a&&(ay(this,Q,!0,"f"),az(this,N,"f").call(this));let c=az(this,P,"f")[a];if(c&&(az(this,P,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];az(this,T,"f")||c?.length||Promise.reject(a),az(this,L,"f").call(this,a),az(this,O,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];az(this,T,"f")||c?.length||Promise.reject(a),az(this,L,"f").call(this,a),az(this,O,"f").call(this,a),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",az(this,H,"m",W).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),c=this.controller.abort.bind(this.controller),d.addEventListener("abort",c));try{az(this,H,"m",Z).call(this),this._connected(null);let b=bc.fromReadableStream(a,this.controller);for await(let a of b)az(this,H,"m",$).call(this,a);if(b.controller.signal?.aborted)throw new aF;az(this,H,"m",_).call(this)}finally{d&&c&&d.removeEventListener("abort",c)}}[(I=new WeakMap,J=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,O=new WeakMap,P=new WeakMap,Q=new WeakMap,R=new WeakMap,S=new WeakMap,T=new WeakMap,U=new WeakMap,V=new WeakMap,Y=new WeakMap,H=new WeakSet,W=function(){if(0===this.receivedMessages.length)throw new aD("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},X=function(){if(0===this.receivedMessages.length)throw new aD("stream ended without producing a Message with role=assistant");let a=this.receivedMessages.at(-1).content.filter(a=>"text"===a.type).map(a=>a.text);if(0===a.length)throw new aD("stream ended without producing a content block with type=text");return a.join(" ")},Z=function(){this.ended||ay(this,I,void 0,"f")},$=function(a){if(this.ended)return;let b=az(this,H,"m",aa).call(this,a);switch(this._emit("streamEvent",a,b),a.type){case"content_block_delta":{let c=b.content.at(-1);switch(a.delta.type){case"text_delta":"text"===c.type&&this._emit("text",a.delta.text,c.text||"");break;case"citations_delta":"text"===c.type&&this._emit("citation",a.delta.citation,c.citations??[]);break;case"input_json_delta":bU(c)&&c.input&&this._emit("inputJson",a.delta.partial_json,c.input);break;case"thinking_delta":"thinking"===c.type&&this._emit("thinking",a.delta.thinking,c.thinking);break;case"signature_delta":"thinking"===c.type&&this._emit("signature",c.signature);break;default:a.delta}break}case"message_stop":this._addMessageParam(b),this._addMessage(b,!0);break;case"content_block_stop":this._emit("contentBlock",b.content.at(-1));break;case"message_start":ay(this,I,b,"f")}},_=function(){if(this.ended)throw new aD("stream has ended, this shouldn't happen");let a=az(this,I,"f");if(!a)throw new aD("request ended without sending any chunks");return ay(this,I,void 0,"f"),a},aa=function(a){let b=az(this,I,"f");if("message_start"===a.type){if(b)throw new aD(`Unexpected event order, got ${a.type} before receiving "message_stop"`);return a.message}if(!b)throw new aD(`Unexpected event order, got ${a.type} before "message_start"`);switch(a.type){case"message_stop":case"content_block_stop":return b;case"message_delta":return b.stop_reason=a.delta.stop_reason,b.stop_sequence=a.delta.stop_sequence,b.usage.output_tokens=a.usage.output_tokens,null!=a.usage.input_tokens&&(b.usage.input_tokens=a.usage.input_tokens),null!=a.usage.cache_creation_input_tokens&&(b.usage.cache_creation_input_tokens=a.usage.cache_creation_input_tokens),null!=a.usage.cache_read_input_tokens&&(b.usage.cache_read_input_tokens=a.usage.cache_read_input_tokens),null!=a.usage.server_tool_use&&(b.usage.server_tool_use=a.usage.server_tool_use),b;case"content_block_start":return b.content.push({...a.content_block}),b;case"content_block_delta":{let c=b.content.at(a.index);switch(a.delta.type){case"text_delta":c?.type==="text"&&(b.content[a.index]={...c,text:(c.text||"")+a.delta.text});break;case"citations_delta":c?.type==="text"&&(b.content[a.index]={...c,citations:[...c.citations??[],a.delta.citation]});break;case"input_json_delta":if(c&&bU(c)){let d=c[bT]||"";d+=a.delta.partial_json;let e={...c};Object.defineProperty(e,bT,{value:d,enumerable:!1,writable:!0}),d&&(e.input=bK(d)),b.content[a.index]=e}break;case"thinking_delta":c?.type==="thinking"&&(b.content[a.index]={...c,thinking:c.thinking+a.delta.thinking});break;case"signature_delta":c?.type==="thinking"&&(b.content[a.index]={...c,signature:a.delta.signature});break;default:a.delta}return b}}},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("streamEvent",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new bc(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class bW extends bz{create(a,b){return this._client.post("/v1/messages/batches",{body:a,...b})}retrieve(a,b){return this._client.get(bE`/v1/messages/batches/${a}`,b)}list(a={},b){return this._client.getAPIList("/v1/messages/batches",bl,{query:a,...b})}delete(a,b){return this._client.delete(bE`/v1/messages/batches/${a}`,b)}cancel(a,b){return this._client.post(bE`/v1/messages/batches/${a}/cancel`,b)}async results(a,b){let c=await this.retrieve(a);if(!c.results_url)throw new aD(`No batch \`results_url\`; Has it finished processing? ${c.processing_status} - ${c.id}`);return this._client.get(c.results_url,{...b,headers:bB([{Accept:"application/binary"},b?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,b)=>bH.fromResponse(b.response,b.controller))}}class bX extends bz{constructor(){super(...arguments),this.batches=new bW(this._client)}create(a,b){a.model in bY&&console.warn(`The model '${a.model}' is deprecated and will reach end-of-life on ${bY[a.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let c=this._client._options.timeout;if(!a.stream&&null==c){let b=bO[a.model]??void 0;c=this._client.calculateNonstreamingTimeout(a.max_tokens,b)}return this._client.post("/v1/messages",{body:a,timeout:c??6e5,...b,stream:a.stream??!1})}stream(a,b){return bV.createMessage(this,a,b)}countTokens(a,b){return this._client.post("/v1/messages/count_tokens",{body:a,...b})}}let bY={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-5-sonnet-20241022":"October 22, 2025","claude-3-5-sonnet-20240620":"October 22, 2025"};bX.Batches=bW;class bZ extends bz{retrieve(a,b={},c){let{betas:d}=b??{};return this._client.get(bE`/v1/models/${a}`,{...c,headers:bB([{...d?.toString()!=null?{"anthropic-beta":d?.toString()}:void 0},c?.headers])})}list(a={},b){let{betas:c,...d}=a??{};return this._client.getAPIList("/v1/models",bl,{query:d,...b,headers:bB([{...c?.toString()!=null?{"anthropic-beta":c?.toString()}:void 0},b?.headers])})}}let b$=a=>void 0!==globalThis.process?globalThis.process.env?.[a]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(a)?.trim():void 0;class b_{constructor({baseURL:a=b$("ANTHROPIC_BASE_URL"),apiKey:b=b$("ANTHROPIC_API_KEY")??null,authToken:c=b$("ANTHROPIC_AUTH_TOKEN")??null,...d}={}){ab.add(this),ad.set(this,void 0);let e={apiKey:b,authToken:c,...d,baseURL:a||"https://api.anthropic.com"};if(!e.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new aD("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n");this.baseURL=e.baseURL,this.timeout=e.timeout??ac.DEFAULT_TIMEOUT,this.logger=e.logger??console;let f="warn";this.logLevel=f,this.logLevel=a5(e.logLevel,"ClientOptions.logLevel",this)??a5(b$("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??f,this.fetchOptions=e.fetchOptions,this.maxRetries=e.maxRetries??2,this.fetch=e.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),ay(this,ad,a0,"f"),this._options=e,this.apiKey=b,this.authToken=c}withOptions(a){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...a})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:b}){if(!(this.apiKey&&a.get("x-api-key")||b.has("x-api-key")||this.authToken&&a.get("authorization"))&&!b.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(a){return bB([await this.apiKeyAuth(a),await this.bearerAuth(a)])}async apiKeyAuth(a){if(null!=this.apiKey)return bB([{"X-Api-Key":this.apiKey}])}async bearerAuth(a){if(null!=this.authToken)return bB([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new aD(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${aV}`}defaultIdempotencyKey(){return`stainless-node-retry-${aA()}`}makeStatusError(a,b,c,d){return aE.generate(a,b,c,d)}buildURL(a,b,c){let d=!az(this,ab,"m",ae).call(this)&&c||this.baseURL,e=new URL(aQ.test(a)?a:d+(d.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),f=this.defaultQuery();return!function(a){if(!a)return!0;for(let b in a)return!1;return!0}(f)&&(b={...f,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(e.search=this.stringifyQuery(b)),e.toString()}_calculateNonstreamingTimeout(a){if(3600*a/128e3>600)throw new aD("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(c=>({method:a,path:b,...c})))}request(a,b=null){return new bi(this,this.makeRequest(a,b,void 0))}async makeRequest(a,b,c){let d=await a,e=d.maxRetries??this.maxRetries;null==b&&(b=e),await this.prepareOptions(d);let{req:f,url:g,timeout:h}=await this.buildRequest(d,{retryCount:e-b});await this.prepareRequest(f,{url:g,options:d});let i="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),j=void 0===c?"":`, retryOf: ${c}`,k=Date.now();if(ba(this).debug(`[${i}] sending request`,bb({retryOfRequestLogID:c,method:d.method,url:g,options:d,headers:f.headers})),d.signal?.aborted)throw new aF;let l=new AbortController,m=await this.fetchWithTimeout(g,f,h,l).catch(aC),n=Date.now();if(m instanceof globalThis.Error){let a=`retrying, ${b} attempts remaining`;if(d.signal?.aborted)throw new aF;let e=aB(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(b)return ba(this).info(`[${i}] connection ${e?"timed out":"failed"} - ${a}`),ba(this).debug(`[${i}] connection ${e?"timed out":"failed"} (${a})`,bb({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),this.retryRequest(d,b,c??i);if(ba(this).info(`[${i}] connection ${e?"timed out":"failed"} - error; no more retries left`),ba(this).debug(`[${i}] connection ${e?"timed out":"failed"} (error; no more retries left)`,bb({retryOfRequestLogID:c,url:g,durationMs:n-k,message:m.message})),e)throw new aH;throw new aG({cause:m})}let o=[...m.headers.entries()].filter(([a])=>"request-id"===a).map(([a,b])=>", "+a+": "+JSON.stringify(b)).join(""),p=`[${i}${j}${o}] ${f.method} ${g} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${n-k}ms`;if(!m.ok){let a=await this.shouldRetry(m);if(b&&a){let a=`retrying, ${b} attempts remaining`;return await a_(m.body),ba(this).info(`${p} - ${a}`),ba(this).debug(`[${i}] response error (${a})`,bb({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),this.retryRequest(d,b,c??i,m.headers)}let e=a?"error; no more retries left":"error; not retryable";ba(this).info(`${p} - ${e}`);let f=await m.text().catch(a=>aC(a).message),g=aU(f),h=g?void 0:f;throw ba(this).debug(`[${i}] response error (${e})`,bb({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,message:h,durationMs:Date.now()-k})),this.makeStatusError(m.status,g,h,m.headers)}return ba(this).info(p),ba(this).debug(`[${i}] response start`,bb({retryOfRequestLogID:c,url:m.url,status:m.status,headers:m.headers,durationMs:n-k})),{response:m,options:d,controller:l,requestLogID:i,retryOfRequestLogID:c,startTime:k}}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}requestAPIList(a,b){return new bk(this,this.makeRequest(b,null,void 0),a)}async fetchWithTimeout(a,b,c,d){let{signal:e,method:f,...g}=b||{};e&&e.addEventListener("abort",()=>d.abort());let h=setTimeout(()=>d.abort(),c),i=globalThis.ReadableStream&&g.body instanceof globalThis.ReadableStream||"object"==typeof g.body&&null!==g.body&&Symbol.asyncIterator in g.body,j={signal:d.signal,...i?{duplex:"half"}:{},method:"GET",...g};f&&(j.method=f.toUpperCase());try{return await this.fetch.call(void 0,a,j)}finally{clearTimeout(h)}}async shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c,d){let e,f,g=d?.get("retry-after-ms");if(g){let a=parseFloat(g);Number.isNaN(a)||(e=a)}let h=d?.get("retry-after");if(h&&!e){let a=parseFloat(h);e=Number.isNaN(a)?Date.parse(h)-Date.now():1e3*a}if(!(e&&0<=e&&e<6e4)){let c=a.maxRetries??this.maxRetries;e=this.calculateDefaultRetryTimeoutMillis(b,c)}return await (f=e,new Promise(a=>setTimeout(a,f))),this.makeRequest(a,b-1,c)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(a,b){if(36e5*a/128e3>6e5||null!=b&&a>b)throw new aD("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,defaultBaseURL:g}=c,h=this.buildURL(e,f,g);"timeout"in c&&((a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new aD(`${a} must be an integer`);if(b<0)throw new aD(`${a} must be a positive integer`)})("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let{bodyHeaders:i,body:j}=this.buildBody({options:c}),k=await this.buildHeaders({options:a,method:d,bodyHeaders:i,retryCount:b});return{req:{method:d,headers:k,...c.signal&&{signal:c.signal},...globalThis.ReadableStream&&j instanceof globalThis.ReadableStream&&{duplex:"half"},...j&&{body:j},...this.fetchOptions??{},...c.fetchOptions??{}},url:h,timeout:c.timeout}}async buildHeaders({options:a,method:b,bodyHeaders:c,retryCount:e}){let f={};this.idempotencyHeader&&"get"!==b&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),f[this.idempotencyHeader]=a.idempotencyKey);let g=bB([f,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(e),...a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{},...d??(d=(()=>{let a="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aV,"X-Stainless-OS":aX(Deno.build.os),"X-Stainless-Arch":aW(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===a)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aV,"X-Stainless-OS":aX(globalThis.process.platform??"unknown"),"X-Stainless-Arch":aW(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let b=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return b?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${b.browser}`,"X-Stainless-Runtime-Version":b.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":aV,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(a),this._options.defaultHeaders,c,a.headers]);return this.validateHeaders(g),g.values}buildBody({options:{body:a,headers:b}}){if(!a)return{bodyHeaders:void 0,body:void 0};let c=bB([b]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||"string"==typeof a&&c.values.has("content-type")||globalThis.Blob&&a instanceof globalThis.Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:"object"==typeof a&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&"function"==typeof a.next)?{bodyHeaders:void 0,body:aZ(a)}:az(this,ad,"f").call(this,{body:a,headers:c})}}ac=b_,ad=new WeakMap,ab=new WeakSet,ae=function(){return"https://api.anthropic.com"!==this.baseURL},b_.Anthropic=ac,b_.HUMAN_PROMPT="\\n\\nHuman:",b_.AI_PROMPT="\\n\\nAssistant:",b_.DEFAULT_TIMEOUT=6e5,b_.AnthropicError=aD,b_.APIError=aE,b_.APIConnectionError=aG,b_.APIConnectionTimeoutError=aH,b_.APIUserAbortError=aF,b_.NotFoundError=aL,b_.ConflictError=aM,b_.RateLimitError=aO,b_.BadRequestError=aI,b_.AuthenticationError=aJ,b_.InternalServerError=aP,b_.PermissionDeniedError=aK,b_.UnprocessableEntityError=aN,b_.toFile=bx;class b0 extends b_{constructor(){super(...arguments),this.completions=new bS(this),this.messages=new bX(this),this.models=new bZ(this),this.beta=new bR(this)}}b0.Completions=bS,b0.Messages=bX,b0.Models=bZ,b0.Beta=bR;let b1=new b0({apiKey:process.env.ANTHROPIC_API_KEY||""});async function b2(a){try{let{message:b,userId:c}=await a.json();if(!b||!c)return aw.NextResponse.json({error:"Message and userId are required"},{status:400});if(!process.env.ANTHROPIC_API_KEY||"your_anthropic_api_key_here"===process.env.ANTHROPIC_API_KEY)return aw.NextResponse.json({response:`⚠️ **Claude API Key Required**

To enable the AI agent, please:
1. Get an API key from https://console.anthropic.com/
2. Add it to your .env.local file as ANTHROPIC_API_KEY=your_actual_key
3. Restart the development server

For now, I can provide SAFe guidance based on your content using built-in knowledge. What would you like help with?`});let d=await (0,ax.d)(),{data:{user:e}}=await d.auth.getUser();if(!e||e.id!==c)return aw.NextResponse.json({error:"Unauthorized"},{status:401});let[f,g,h,i,j]=await Promise.all([d.from("documents").select(`
          title, content, file_type, artifact_type, priority, tags,
          folder_id,
          folders!inner(name, parent_id)
        `).eq("user_id",c).order("updated_at",{ascending:!1}).limit(15),d.from("notes").select(`
          title, content, meeting_type, participants,
          folder_id,
          folders!inner(name, parent_id)
        `).eq("user_id",c).order("updated_at",{ascending:!1}).limit(15),d.from("audios").select(`
          title, transcription, meeting_type, participants,
          folder_id,
          folders!inner(name, parent_id)
        `).eq("user_id",c).order("updated_at",{ascending:!1}).limit(15),d.from("todos").select(`
          title, description, status, priority, due_date, source, source_type,
          folder_id,
          folders(name, parent_id)
        `).eq("user_id",c).order("updated_at",{ascending:!1}).limit(20),d.from("folders").select("id, name, parent_id").eq("user_id",c).order("name")]),k=f.data||[],l=g.data||[],m=h.data||[],n=i.data||[],o=j.data||[],p=new Map(o.map(a=>[a.id,a])),q=a=>{let b=p.get(a);if(!b)return"No folder";if(b.parent_id){let a=q(b.parent_id);return`${a} > ${b.name}`}return b.name},r={folderStructure:o.map(a=>({name:a.name,path:q(a.id),isFeatureFolder:a.name.includes("Context")||a.name.includes("Meeting")||a.name.includes("User Stories"),isGeneralContext:"General Context"===a.name||a.name.includes("Technology")||a.name.includes("Team")})),documents:k.map(a=>({title:a.title,file_type:a.file_type,artifact_type:a.artifact_type,priority:a.priority,tags:a.tags,folder:a.folder_id?q(a.folder_id):"No folder",content:a.content?.substring(0,15e3)})),notes:l.map(a=>({title:a.title,content:a.content?.substring(0,1e4),meeting_type:a.meeting_type,participants:a.participants,folder:a.folder_id?q(a.folder_id):"No folder"})),audios:m.map(a=>({title:a.title,transcription:a.transcription?.substring(0,1e4),meeting_type:a.meeting_type,participants:a.participants,folder:a.folder_id?q(a.folder_id):"No folder"})),todos:n.map(a=>({title:a.title,description:a.description,status:a.status,priority:a.priority,due_date:a.due_date,source:a.source,source_type:a.source_type,folder:a.folder_id?q(a.folder_id):"No folder"}))},s=`You are a SAFe (Scaled Agile Framework) and Agile expert AI assistant specializing in helping Product Owners and teams with SAFe practices. You have deep expertise in:

**Core SAFe Knowledge:**
- INVEST criteria for user story quality (Independent, Negotiable, Valuable, Estimable, Small, Testable)
- WSJF prioritization (Weighted Shortest Job First): Cost of Delay \xf7 Job Size
- PI Planning facilitation and best practices
- SAFe artifacts: Epics, Features, User Stories, Capabilities, Solutions
- Meeting types: Sprint Planning, Retrospectives, Daily Standups, System Demos, PI Planning, Inspect & Adapt
- Acceptance criteria generation and validation
- Backlog management and prioritization
- Dependency identification and risk management
- Value stream optimization

**User's Current Content:**
Documents: ${k.length} files (${Array.from(new Set(k.map(a=>a.file_type).filter(Boolean))).join(", ")})
Notes: ${l.length} entries
Audio Recordings: ${m.length} transcriptions
Todos: ${n.length} tasks (${n.filter(a=>"pending"===a.status).length} pending, ${n.filter(a=>"in_progress"===a.status).length} in progress, ${n.filter(a=>"completed"===a.status).length} completed)

**Available Content Details:**
${JSON.stringify(r,null,2)}

**IMPORTANT: You have FULL ACCESS to the actual content of these documents, notes, and audio transcriptions above. When users ask you to analyze, summarize, or reference their content, use the exact text provided in the contextData above. Do not claim you cannot access the content - you can see it all.**

**Your Role:**
- Provide actionable SAFe guidance based on the user's actual content
- Reference specific documents, notes, audio, and todos when relevant
- Apply SAFe principles to real scenarios
- Offer concrete recommendations and next steps
- Help with story writing, backlog prioritization, and planning
- Identify gaps and improvement opportunities
- **Manage todos** - analyze current tasks, suggest new ones based on content, help prioritize
- Extract actionable items from documents and meeting notes to create todos
- **Create folders** when users request organization or when you recommend organizing content
- Suggest and implement folder structures for SAFe artifacts (Epics, Features, User Stories, etc.)

**Available Actions:**

**1. Create Folders:**
When users ask to create folders or you recommend organization, include this command:
**[CREATE_FOLDER: folder_name]**

Example: **[CREATE_FOLDER: Epic 1 - User Authentication]**

**2. Create Todos:**
When you identify actionable items or users request todo creation, include this command:
**[CREATE_TODO: title|description|priority|due_date]**

Where:
- title: Short, actionable title (required)
- description: Detailed description (optional, use "" if empty)
- priority: High, Medium, or Low (optional, defaults to Medium)
- due_date: YYYY-MM-DD format (optional, use "" if no date)

Examples:
- **[CREATE_TODO: Review user story acceptance criteria|Ensure all user stories meet INVEST criteria|High|2024-01-15]**
- **[CREATE_TODO: Update team retrospective notes|Consolidate feedback from last sprint|Medium|]**
- **[CREATE_TODO: Schedule PI Planning session|Coordinate with all teams for Q2 planning||2024-01-30]**

Folders and todos will be created automatically and you should mention this in your response.

**Communication Style:**
- Be practical and actionable
- Use markdown formatting for clarity
- Reference the user's content when applicable
- Provide specific examples and recommendations
- Structure responses with clear sections when helpful
- When recommending folder organization, proactively offer to create folders using the CREATE_FOLDER command

Analyze the user's question in the context of their available content and provide expert SAFe guidance.`,t=await b1.messages.create({model:"claude-3-haiku-20240307",max_tokens:2e3,temperature:.7,system:s,messages:[{role:"user",content:b}]}),u=t.content[0]?.text||"I apologize, but I encountered an issue generating a response. Please try again.",v=/\*\*\[CREATE_FOLDER:\s*([^\]]+)\]\*\*/g,w=Array.from(u.matchAll(v));if(w.length>0){let a=[];for(let b of w){let c=b[1].trim();try{let{data:b,error:f}=await d.from("folders").insert([{name:c,user_id:e.id}]).select().single();!f&&b&&a.push(c)}catch(a){console.error("Error creating folder:",c,a)}}if(u=u.replace(v,""),a.length>0){let b=`

✅ **Folders Created Successfully:**
${a.map(a=>`- ${a}`).join("\n")}

You can now organize your documents, notes, and audio files into these folders through the respective sections of the application.`;u+=b}}let x=/\*\*\[CREATE_TODO:\s*([^|]+)\|([^|]*)\|([^|]*)\|([^\]]*)\]\*\*/g,y=Array.from(u.matchAll(x));if(y.length>0){let a=[];for(let b of y){let c=b[1].trim(),f=b[2].trim()||null,g=b[3].trim()||"Medium",h=b[4].trim()||null,i=["High","Medium","Low"].includes(g)?g:"Medium",j=h&&/^\d{4}-\d{2}-\d{2}$/.test(h)?h:null;try{let{data:b,error:g}=await d.from("todos").insert([{title:c,description:f,priority:i,due_date:j,source:"auto_detected",user_id:e.id}]).select().single();!g&&b&&a.push(c)}catch(a){console.error("Error creating todo:",c,a)}}if(u=u.replace(x,""),a.length>0){let b=`

✅ **Todos Created Successfully:**
${a.map(a=>`- ${a}`).join("\n")}

You can view and manage these todos in the Todo section of the application.`;u+=b}}return aw.NextResponse.json({response:u})}catch(a){if(console.error("Chat API error:",a),a instanceof Error){if(a.message.includes("API key")||a.message.includes("authentication"))return aw.NextResponse.json({response:`🔑 **API Key Error**

There's an issue with the Claude API key. Please check that:
1. Your API key is valid and active
2. You have sufficient credits/quota
3. The key has the necessary permissions

Error: ${a.message}`});if(a.message.includes("rate limit"))return aw.NextResponse.json({response:`⏱️ **Rate Limit Reached**

The API rate limit has been exceeded. Please wait a moment and try again.

This happens when there are too many requests in a short time period.`})}return aw.NextResponse.json({error:"Internal server error"},{status:500})}}let b3=new ag.AppRouteRouteModule({definition:{kind:ah.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/paulojuri/document-ai-assistant/src/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:af}),{workAsyncStorage:b4,workUnitAsyncStorage:b5,serverHooks:b6}=b3;function b7(){return(0,ai.patchFetch)({workAsyncStorage:b4,workUnitAsyncStorage:b5})}async function b8(a,b,c){var d;let e="/api/chat/route";"/index"===e&&(e="/");let f=await b3.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,al.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new au.NoFallbackError}let r=null;!q||b3.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===b3.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,ak.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!i.experimental.cacheComponents,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,aj.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>b3.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new am.NodeNextRequest(a),z=new am.NodeNextResponse(b),A=an.NextRequestAdapter.fromNodeNextRequest(y,(0,an.signalFromNodeResponse)(b));try{let d=async c=>b3.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==ao.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,aj.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,aq.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,ar.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[at.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=at.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=at.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:av.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await b3.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,ap.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await b3.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:ah.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==av.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,aj.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,ar.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,aj.getRequestMeta)(a,"minimalMode")&&q||s.delete(at.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,as.getCacheControlHeader)(p.cacheControl)),await (0,aq.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(ao.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:ak.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(w||b instanceof au.NoFallbackError||await b3.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,ap.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,aq.I)(y,z,new Response(null,{status:500})),null}}},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[586,873,802,692],()=>b(b.s=50800));module.exports=c})();