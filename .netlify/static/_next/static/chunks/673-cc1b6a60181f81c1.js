"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{1647:(e,t,r)=>{r.d(t,{E:()=>l});var a=r(5155);r(2115);var s=r(3101),i=r(4269);let n=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-[var(--primary-green)] text-white hover:bg-[var(--dark-green)]",secondary:"border-transparent bg-[var(--secondary)] text-[var(--secondary-foreground)] hover:bg-[var(--secondary)]/80",destructive:"border-transparent bg-[var(--error-red)] text-white hover:bg-red-600",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)(n({variant:r}),t),...s})}},3998:(e,t,r)=>{r.d(t,{$:()=>d});var a=r(5155),s=r(2115),i=r(2467),n=r(3101),l=r(4269);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-[var(--primary-green)] text-white hover:bg-[var(--dark-green)]",destructive:"bg-[var(--error-red)] text-white hover:bg-red-600",outline:"border border-[var(--border)] bg-background hover:bg-[var(--secondary)] hover:text-[var(--secondary-foreground)]",secondary:"bg-[var(--secondary)] text-[var(--secondary-foreground)] hover:bg-[var(--secondary)]/80",ghost:"hover:bg-[var(--secondary)] hover:text-[var(--secondary-foreground)]",link:"text-[var(--primary-green)] underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:d=!1,...c}=e,u=d?i.DX:"button";return(0,a.jsx)(u,{className:(0,l.cn)(o({variant:s,size:n,className:r})),ref:t,...c})});d.displayName="Button"},4269:(e,t,r)=>{r.d(t,{cn:()=>i,eX:()=>d,fK:()=>o,oP:()=>l,z3:()=>n});var a=r(2821),s=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function n(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function l(e){return e&&({pdf:"\uD83D\uDCC4",docx:"\uD83D\uDCDD",txt:"\uD83D\uDCC4",md:"\uD83D\uDCDD",mp3:"\uD83C\uDFB5",wav:"\uD83C\uDFB5",mp4:"\uD83C\uDFA5"})[e.toLowerCase()]||"\uD83D\uDCC4"}function o(e){return({Epic:"bg-purple-100 text-purple-800",Feature:"bg-blue-100 text-blue-800","User Story":"bg-green-100 text-green-800",Capability:"bg-orange-100 text-orange-800",Solution:"bg-red-100 text-red-800",Theme:"bg-yellow-100 text-yellow-800",Enabler:"bg-gray-100 text-gray-800"})[e]||"bg-gray-100 text-gray-800"}function d(e){return({High:"text-red-600",Medium:"text-yellow-600",Low:"text-green-600"})[e]||"text-gray-600"}},5142:(e,t,r)=>{r.d(t,{p:()=>n});var a=r(5155),s=r(2115),i=r(4269);let n=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-10 w-full rounded-md border border-[var(--border)] bg-[var(--input)] px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-[var(--muted-foreground)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--primary-green)] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});n.displayName="Input"},6648:(e,t,r)=>{r.d(t,{S:()=>n});var a=r(7559);let s="https://nugjghwkvfkdbgrgsazv.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51Z2pnaHdrdmZrZGJncmdzYXp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MjM3NzMsImV4cCI6MjA3MzQ5OTc3M30.6iaRtFDTdss9YgKaPYnP63A1TC2FNqN4ywPlRnrrssA";if(!s||!i)throw Error("Missing Supabase environment variables. Please check NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");let n=()=>(0,a.createBrowserClient)(s,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},6948:(e,t,r)=>{r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>l});var a=r(5155),s=r(2115),i=r(4269);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--card-foreground)] shadow-sm",r),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});o.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-[var(--muted-foreground)]",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},7014:(e,t,r)=>{r.d(t,{A:()=>o,AuthProvider:()=>d});var a=r(5155),s=r(2115),i=r(63),n=r(6648);let l=(0,s.createContext)({user:null,session:null,loading:!0,signOut:async()=>{}}),o=()=>{let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};function d(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0),[h,f]=(0,s.useState)(!0),x=(0,i.useRouter)(),p=(0,i.usePathname)(),v=(0,n.S)();(0,s.useEffect)(()=>{let e=!0;(async()=>{try{let{data:{session:r}}=await v.auth.getSession();if(e){var t;c(r),o(null!=(t=null==r?void 0:r.user)?t:null),m(!1),f(!1)}}catch(t){console.error("Error getting session:",t),e&&(m(!1),f(!1))}})();let{data:{subscription:t}}=v.auth.onAuthStateChange(async(t,r)=>{if(e&&!h){var a;c(r),o(null!=(a=null==r?void 0:r.user)?a:null),m(!1),"SIGNED_IN"===t&&r&&p.startsWith("/auth")&&x.push("/dashboard"),"SIGNED_OUT"===t&&x.push("/auth/login")}});return()=>{e=!1,t.unsubscribe()}},[v.auth,x,p,h]);let g=async()=>{try{await v.auth.signOut()}catch(e){console.error("Error signing out:",e),x.push("/auth/login")}};return(0,a.jsx)(l.Provider,{value:{user:r,session:d,loading:u,signOut:g},children:t})}},7673:(e,t,r)=>{r.d(t,{MainLayout:()=>J});var a=r(5155),s=r(63),i=r(2115),n=r(2619),l=r.n(n),o=r(5998),d=r(5229),c=r(5870),u=r(4926),m=r(3998),h=r(6651),f=r(6955),x=r(5142),p=r(6948),v=r(1647),g=r(7675),b=r(6648);class y{async getFolders(e){let{data:t,error:r}=await this.supabase.from("folders").select("\n        *,\n        documents(count)\n      ").eq("user_id",e).order("created_at",{ascending:!0});if(r)throw Error("Failed to fetch folders: ".concat(r.message));let a=new Map,s=[];return t.forEach(e=>{var t,r;let s={...e,children:[],document_count:(null==(r=e.documents)||null==(t=r[0])?void 0:t.count)||0};a.set(e.id,s)}),t.forEach(e=>{let t=a.get(e.id);if(e.parent_id){let r=a.get(e.parent_id);r&&r.children.push(t)}else s.push(t)}),s}async getFolder(e,t){let{data:r,error:a}=await this.supabase.from("folders").select("*").eq("id",e).eq("user_id",t).single();if(a)throw Error("Failed to fetch folder: ".concat(a.message));return r}async createFolder(e){let{data:t,error:r}=await this.supabase.from("folders").insert(e).select().single();if(r)throw Error("Failed to create folder: ".concat(r.message));return t}async updateFolder(e,t,r){let{data:a,error:s}=await this.supabase.from("folders").update(t).eq("id",e).eq("user_id",r).select().single();if(s)throw Error("Failed to update folder: ".concat(s.message));return a}async deleteFolder(e,t){let{data:r,error:a}=await this.supabase.from("folders").select("id").eq("parent_id",e).eq("user_id",t);if(a)throw Error("Failed to check folder children: ".concat(a.message));if(r&&r.length>0)throw Error("Cannot delete folder with subfolders. Please delete subfolders first.");let{data:s,error:i}=await this.supabase.from("documents").select("id").eq("folder_id",e).eq("user_id",t);if(i)throw Error("Failed to check folder documents: ".concat(i.message));if(s&&s.length>0)throw Error("Cannot delete folder containing documents. Please move or delete documents first.");let{error:n}=await this.supabase.from("folders").delete().eq("id",e).eq("user_id",t);if(n)throw Error("Failed to delete folder: ".concat(n.message));return{success:!0}}async moveFolder(e,t,r){if(t&&await this.checkCircularReference(e,t,r))throw Error("Cannot move folder: this would create a circular reference");return this.updateFolder(e,{parent_id:t},r)}async checkCircularReference(e,t,r){let a=t;for(;a;){if(a===e)return!0;let{data:t,error:s}=await this.supabase.from("folders").select("parent_id").eq("id",a).eq("user_id",r).single();if(s||!t)break;a=t.parent_id}return!1}async getFolderPath(e,t){let r=[],a=e;for(;a;){let e=await this.getFolder(a,t);r.unshift(e),a=e.parent_id}return r}async getFolderStats(e){let{data:t,error:r}=await this.supabase.from("folders").select("safe_artifact").eq("user_id",e);if(r)throw Error("Failed to fetch folder stats: ".concat(r.message));let a={total:t.length,bySafeArtifact:{}};return t.forEach(e=>{e.safe_artifact&&(a.bySafeArtifact[e.safe_artifact]=(a.bySafeArtifact[e.safe_artifact]||0)+1)}),a}async searchFolders(e,t){let{data:r,error:a}=await this.supabase.from("folders").select("*").eq("user_id",e).ilike("name","%".concat(t,"%")).order("name",{ascending:!0});if(a)throw Error("Failed to search folders: ".concat(a.message));return r}constructor(){this.supabase=(0,b.S)()}}let j=new y;var w=r(7014),N=r(4269);function _(e){let{onResultSelect:t,placeholder:r="Search documents, notes, and audio...",showFilters:s=!0}=e,[n,l]=(0,i.useState)(""),[o,c]=(0,i.useState)([]),[u,b]=(0,i.useState)(!1),[y,_]=(0,i.useState)(!1),[A,S]=(0,i.useState)({}),{user:C}=(0,w.A)(),E=function(e,t){let[r,a]=(0,i.useState)(e);return(0,i.useEffect)(()=>{let t=setTimeout(()=>{a(e)},300);return()=>{clearTimeout(t)}},[e,300]),r}(n,300),k=(0,i.useCallback)(async(e,t)=>{if(!C||!e.trim())return void c([]);b(!0);try{let[r,a]=await Promise.all([g.W.searchDocuments(C.id,e,{artifactType:t.artifactType,priority:t.priority,tags:t.tags}),j.searchFolders(C.id,e)]),s=[...r.map(e=>({type:"document",id:e.id,title:e.title,content:e.content,snippet:e.content.substring(0,150)+"...",metadata:{fileType:e.file_type,artifactType:e.artifact_type,priority:e.priority,tags:e.tags,fileSize:e.file_size,updatedAt:e.updated_at}})),...a.map(e=>({type:"folder",id:e.id,title:e.name,metadata:{safeArtifact:e.safe_artifact,parentId:e.parent_id,updatedAt:e.updated_at}}))];c(s)}catch(e){console.error("Search failed:",e),c([])}finally{b(!1)}},[C]);(0,i.useEffect)(()=>{k(E,A)},[E,A,k]);let F=(e,t)=>{if(!t.trim())return e;let r=RegExp("(".concat(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),")"),"gi");return e.split(r).map((e,t)=>r.test(e)?(0,a.jsx)("mark",{className:"bg-yellow-200 text-yellow-900 px-1 rounded",children:e},t):e)},T=Object.values(A).filter(Boolean).length;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-[var(--muted-foreground)] w-4 h-4"}),(0,a.jsx)(x.p,{value:n,onChange:e=>l(e.target.value),placeholder:r,className:"pl-10 pr-20"}),s&&(0,a.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center space-x-1",children:[T>0&&(0,a.jsx)(v.E,{variant:"secondary",className:"text-xs",children:T}),(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:"w-8 h-8",onClick:()=>_(!y),children:(0,a.jsx)(f.A,{className:"w-4 h-4"})}),n&&(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:"w-8 h-8",onClick:()=>l(""),children:(0,a.jsx)(d.A,{className:"w-4 h-4"})})]})]}),y&&(0,a.jsxs)(p.Zp,{className:"absolute top-full left-0 right-0 mt-2 z-50 shadow-lg",children:[(0,a.jsx)(p.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(p.ZB,{className:"text-sm",children:"Search Filters"}),(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>{S({})},children:"Clear All"})]})}),(0,a.jsxs)(p.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Artifact Type"}),(0,a.jsxs)("select",{value:A.artifactType||"",onChange:e=>S(t=>({...t,artifactType:e.target.value||void 0})),className:"w-full px-3 py-2 border border-[var(--border)] rounded-md text-sm",children:[(0,a.jsx)("option",{value:"",children:"All Types"}),(0,a.jsx)("option",{value:"Epic",children:"Epic"}),(0,a.jsx)("option",{value:"Feature",children:"Feature"}),(0,a.jsx)("option",{value:"User Story",children:"User Story"}),(0,a.jsx)("option",{value:"Capability",children:"Capability"}),(0,a.jsx)("option",{value:"Solution",children:"Solution"}),(0,a.jsx)("option",{value:"Theme",children:"Theme"}),(0,a.jsx)("option",{value:"Enabler",children:"Enabler"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Priority"}),(0,a.jsxs)("select",{value:A.priority||"",onChange:e=>S(t=>({...t,priority:e.target.value||void 0})),className:"w-full px-3 py-2 border border-[var(--border)] rounded-md text-sm",children:[(0,a.jsx)("option",{value:"",children:"All Priorities"}),(0,a.jsx)("option",{value:"High",children:"High"}),(0,a.jsx)("option",{value:"Medium",children:"Medium"}),(0,a.jsx)("option",{value:"Low",children:"Low"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"File Type"}),(0,a.jsxs)("select",{value:A.fileType||"",onChange:e=>S(t=>({...t,fileType:e.target.value||void 0})),className:"w-full px-3 py-2 border border-[var(--border)] rounded-md text-sm",children:[(0,a.jsx)("option",{value:"",children:"All File Types"}),(0,a.jsx)("option",{value:"pdf",children:"PDF"}),(0,a.jsx)("option",{value:"docx",children:"DOCX"}),(0,a.jsx)("option",{value:"txt",children:"TXT"}),(0,a.jsx)("option",{value:"md",children:"Markdown"})]})]})]})]}),(n||o.length>0)&&(0,a.jsx)(p.Zp,{className:"absolute top-full left-0 right-0 mt-2 z-40 max-h-96 overflow-y-auto shadow-lg",children:(0,a.jsx)(p.Wu,{className:"p-0",children:u?(0,a.jsx)("div",{className:"p-4 text-center text-[var(--muted-foreground)]",children:"Searching..."}):o.length>0?(0,a.jsx)("div",{className:"space-y-0",children:o.map(e=>{var r,s,i;return(0,a.jsx)("div",{className:"p-4 hover:bg-[var(--muted)] cursor-pointer border-b border-[var(--border)] last:border-0",onClick:()=>null==t?void 0:t(e),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"text-2xl mt-1",children:(e=>{switch(e.type){case"document":var t;return(0,N.oP)((null==(t=e.metadata)?void 0:t.fileType)||"txt");case"folder":return"\uD83D\uDCC1";case"note":return"\uD83D\uDCDD";case"audio":return"\uD83C\uDFB5";default:return"\uD83D\uDCC4"}})(e)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("h4",{className:"font-medium text-sm truncate",children:F(e.title,n)}),(0,a.jsx)(v.E,{variant:"outline",className:"text-xs",children:e.type})]}),e.snippet&&(0,a.jsx)("p",{className:"text-xs text-[var(--muted-foreground)] line-clamp-2",children:F(e.snippet,n)}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(null==(r=e.metadata)?void 0:r.artifactType)&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat((0,N.fK)(e.metadata.artifactType)),children:e.metadata.artifactType}),(null==(s=e.metadata)?void 0:s.priority)&&(0,a.jsxs)("span",{className:"text-xs text-[var(--muted-foreground)]",children:[e.metadata.priority," Priority"]}),(null==(i=e.metadata)?void 0:i.fileSize)&&(0,a.jsx)("span",{className:"text-xs text-[var(--muted-foreground)]",children:(0,N.z3)(e.metadata.fileSize)})]})]})]})},"".concat(e.type,"-").concat(e.id))})}):n?(0,a.jsxs)("div",{className:"p-4 text-center text-[var(--muted-foreground)]",children:['No results found for "',n,'"']}):null})})]})}function A(){var e;let{user:t,signOut:r}=(0,w.A)(),n=(0,s.usePathname)(),[h,f]=(0,i.useState)([]),[x,p]=(0,i.useState)(0),[v,g]=(0,i.useState)(!1),[y,j]=(0,i.useState)(!1);(0,b.S)(),(0,i.useEffect)(()=>{if(t){N(),A();let e=setInterval(()=>{A(),N()},3e5);return()=>clearInterval(e)}},[t]);let N=async()=>{if(t)try{let t=await fetch("/api/notifications?limit=10");if(t.ok){var e;let r=await t.json();f(r.notifications||[]),p((null==(e=r.notifications)?void 0:e.filter(e=>!e.read).length)||0)}}catch(e){console.error("Error loading notifications:",e)}},A=async()=>{if(t)try{await fetch("/api/check-deadlines",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){console.error("Error checking deadlines:",e)}},S=async e=>{try{(await fetch("/api/notifications",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationId:e,read:!0})})).ok&&(f(t=>t.map(t=>t.id===e?{...t,read:!0}:t)),p(e=>Math.max(0,e-1)))}catch(e){console.error("Error marking notification as read:",e)}},C=async()=>{j(!0);try{let e=h.filter(e=>!e.read);await Promise.all(e.map(e=>S(e.id)))}catch(e){console.error("Error marking all as read:",e)}finally{j(!1)}};return(0,a.jsxs)("header",{className:"h-16 border-b border-[var(--border)] bg-[var(--card)] px-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,a.jsxs)(l(),{href:"/dashboard",className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-[var(--primary-green)] rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:"DA"})}),(0,a.jsx)("h1",{className:"text-xl font-bold text-[var(--foreground)]",children:"Document AI Assistant"})]}),(0,a.jsx)("nav",{className:"hidden md:flex items-center space-x-4",children:[{href:"/dashboard",label:"Dashboard"},{href:"/documents",label:"Documents"},{href:"/notes",label:"Notes"},{href:"/todo",label:"Todo"},{href:"/folders",label:"Folders"},{href:"/chat",label:"SAFe Chat"}].map(e=>(0,a.jsx)(l(),{href:e.href,className:"px-3 py-2 text-sm font-medium rounded-md transition-colors ".concat(n===e.href?"bg-[var(--primary-green)] text-white":"text-[var(--muted-foreground)] hover:text-[var(--foreground)] hover:bg-[var(--muted)]"),children:e.label},e.href))})]}),(0,a.jsx)("div",{className:"flex-1 max-w-md mx-8",children:(0,a.jsx)(_,{onResultSelect:e=>{console.log("Selected search result:",e)},placeholder:"Search documents, notes, and todos...",showFilters:!0})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(m.$,{variant:"ghost",size:"icon",onClick:()=>g(!v),className:"relative",children:[(0,a.jsx)(o.A,{className:"w-5 h-5"}),x>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:x>9?"9+":x})]}),v&&(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-80 bg-[var(--card)] border border-[var(--border)] rounded-lg shadow-lg z-50",children:[(0,a.jsxs)("div",{className:"p-3 border-b border-[var(--border)] flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:"Notifications"}),x>0&&(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:C,disabled:y,className:"text-xs",children:"Mark all read"}),(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>g(!1),children:(0,a.jsx)(d.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto",children:0===h.length?(0,a.jsx)("div",{className:"p-4 text-center text-[var(--muted-foreground)] text-sm",children:"No notifications yet"}):h.map(e=>(0,a.jsx)("div",{className:"p-3 border-b border-[var(--border)] hover:bg-[var(--muted)] cursor-pointer ".concat(e.read?"":"bg-blue-50 dark:bg-blue-900/20"),onClick:()=>S(e.id),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.title}),e.message&&(0,a.jsx)("p",{className:"text-xs text-[var(--muted-foreground)] mt-1",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-[var(--muted-foreground)] mt-2",children:(e=>{let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/36e5);if(r<1)return"Just now";if(r<24)return"".concat(r,"h ago");let a=Math.floor(r/24);return a<7?"".concat(a,"d ago"):t.toLocaleDateString()})(e.created_at)})]}),!e.read&&(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-1"})]})},e.id))}),h.length>0&&(0,a.jsx)("div",{className:"p-3 border-t border-[var(--border)] text-center",children:(0,a.jsx)(l(),{href:"/notifications",className:"text-xs text-[var(--primary-green)] hover:underline",children:"View all notifications"})})]})]}),(0,a.jsx)(l(),{href:"/settings",children:(0,a.jsx)(m.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(c.A,{className:"w-5 h-5"})})}),t&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("p",{className:"font-medium",children:(null==(e=t.user_metadata)?void 0:e.name)||t.email})}),(0,a.jsx)(m.$,{variant:"ghost",size:"icon",onClick:r,children:(0,a.jsx)(u.A,{className:"w-5 h-5"})})]})]})]})}var S=r(4033),C=r(7937),E=r(9847),k=r(1786),F=r(9715),T=r(1194),D=r(8192),I=r(2198),z=r(6191);function q(e){let{folders:t,level:r=0}=e,[s,n]=(0,i.useState)(new Set(["1","4","7"]));return(0,a.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded-md hover:bg-[var(--muted)] cursor-pointer group ".concat(r>0?"ml-4":""),onClick:()=>e.children&&(e=>{let t=new Set(s);t.has(e)?t.delete(e):t.add(e),n(t)})(e.id),children:[e.children&&(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:"w-4 h-4 p-0",children:s.has(e.id)?(0,a.jsx)(S.A,{className:"w-3 h-3"}):(0,a.jsx)(C.A,{className:"w-3 h-3"})}),(0,a.jsx)(E.A,{className:"w-4 h-4 text-[var(--primary-green)]"}),(0,a.jsx)("span",{className:"text-sm flex-1",children:e.name}),e.documentCount&&e.documentCount>0&&(0,a.jsx)("span",{className:"text-xs text-[var(--muted-foreground)] bg-[var(--muted)] px-2 py-1 rounded-full",children:e.documentCount})]}),e.children&&s.has(e.id)&&(0,a.jsx)(q,{folders:e.children,level:r+1})]},e.id))})}function P(){let{user:e}=(0,w.A)(),[t,r]=(0,i.useState)([]),[s,n]=(0,i.useState)(!0),o=(0,b.S)();(0,i.useEffect)(()=>{e&&d()},[e]);let d=async()=>{if(e)try{n(!0);let[t,a,s]=await Promise.all([o.from("folders").select("id, name, parent_id").eq("user_id",e.id).order("name"),o.from("documents").select("folder_id").eq("user_id",e.id),o.from("notes").select("folder_id").eq("user_id",e.id)]);if(t.error)throw t.error;let i=t.data||[],l=a.data||[],d=s.data||[],c=i.reduce((e,t)=>{let r=l.filter(e=>e.folder_id===t.id).length,a=d.filter(e=>e.folder_id===t.id).length;return e[t.id]=r+a,e},{}),u=i.map(e=>({...e,children:[],documentCount:c[e.id]||0})),m=new Map;u.forEach(e=>m.set(e.id,e));let h=[];u.forEach(e=>{if(e.parent_id){let t=m.get(e.parent_id);t&&(t.children||(t.children=[]),t.children.push(e))}else h.push(e)}),r(h)}catch(e){console.error("Error loading folders:",e)}finally{n(!1)}};return(0,a.jsxs)("aside",{className:"w-80 border-r border-[var(--border)] bg-[var(--card)] flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-[var(--border)]",children:[(0,a.jsx)("h2",{className:"font-semibold text-lg mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l(),{href:"/documents",children:(0,a.jsxs)(m.$,{className:"w-full justify-start",variant:"default",children:[(0,a.jsx)(k.A,{className:"w-4 h-4 mr-2"}),"Upload Document"]})}),(0,a.jsx)(l(),{href:"/notes",children:(0,a.jsxs)(m.$,{className:"w-full justify-start",variant:"outline",children:[(0,a.jsx)(F.A,{className:"w-4 h-4 mr-2"}),"New Note"]})}),(0,a.jsx)(l(),{href:"/todo",children:(0,a.jsxs)(m.$,{className:"w-full justify-start",variant:"outline",children:[(0,a.jsx)(T.A,{className:"w-4 h-4 mr-2"}),"Todo"]})}),(0,a.jsx)(l(),{href:"/chat",children:(0,a.jsxs)(m.$,{className:"w-full justify-start",variant:"outline",children:[(0,a.jsx)(D.A,{className:"w-4 h-4 mr-2"}),"SAFe Chat"]})}),(0,a.jsx)(l(),{href:"/folders",children:(0,a.jsxs)(m.$,{className:"w-full justify-start",variant:"outline",children:[(0,a.jsx)(I.A,{className:"w-4 h-4 mr-2"}),"New Folder"]})})]})]}),(0,a.jsxs)("div",{className:"p-4 border-b border-[var(--border)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Folders"}),(0,a.jsx)(l(),{href:"/folders",children:(0,a.jsx)(m.$,{variant:"ghost",size:"icon",className:"w-6 h-6",children:(0,a.jsx)(z.A,{className:"w-4 h-4"})})})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto scrollbar-hide",children:s?(0,a.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-[var(--primary-green)] border-t-transparent rounded-full animate-spin"})}):0===t.length?(0,a.jsxs)("div",{className:"text-center py-4 text-[var(--muted-foreground)]",children:[(0,a.jsx)(E.A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-xs",children:"No folders yet"}),(0,a.jsx)(l(),{href:"/folders",className:"text-xs text-[var(--primary-green)] hover:underline",children:"Create your first folder"})]}):(0,a.jsx)(q,{folders:t})})]})]})}function M(e){let{onClick:t,isOpen:r}=e;return(0,a.jsx)("div",{className:"fixed bottom-6 right-6 z-50",children:(0,a.jsxs)(m.$,{onClick:t,className:"\n          relative h-14 w-14 rounded-full shadow-lg transition-all duration-300 ease-in-out\n          ".concat(r?"bg-[var(--error-red)] hover:bg-[var(--error-red)] scale-110":"bg-[var(--primary-green)] hover:bg-[var(--dark-green)] hover:scale-110","\n          group\n        "),"aria-label":r?"Close AI Chat":"Open AI Chat",children:[!r&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-[var(--primary-green)] animate-ping opacity-20"}),(0,a.jsx)("div",{className:"transition-transform duration-300 ".concat(r?"rotate-180":"rotate-0"),children:r?(0,a.jsx)(d.A,{className:"h-6 w-6 text-white"}):(0,a.jsx)(D.A,{className:"h-6 w-6 text-white group-hover:scale-110 transition-transform"})}),(0,a.jsx)("div",{className:"\n          absolute bottom-full right-0 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded\n          whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200\n          group-hover:opacity-100\n        ",children:r?"Close AI Chat":"Ask SAFe AI"})]})})}var $=r(7624),R=r(508),B=r(8085);function O(e){let{isOpen:t,onClose:r}=e,[s,n]=(0,i.useState)([]),[l,o]=(0,i.useState)(""),[c,u]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),p=(0,i.useRef)(null),{user:v}=(0,w.A)();(0,i.useEffect)(()=>{t&&0===s.length&&n([{id:"1",role:"assistant",content:"Hi! I'm your SAFe AI Assistant. \uD83E\uDD16\n\nI can help you with:\n• **Analyze documents** using INVEST criteria\n• **Prioritize backlog** with WSJF scoring\n• **Review meeting notes** for action items\n• **Create folders** for organization\n\nWhat would you like help with?",timestamp:new Date}])},[t,s.length]),(0,i.useEffect)(()=>{if(!h){var e;null==(e=p.current)||e.scrollIntoView({behavior:"smooth"})}},[s,h]);let g=async e=>{let t=e||l.trim();if(!t||!v)return;let r={id:Date.now().toString(),role:"user",content:t,timestamp:new Date},a=(Date.now()+1).toString(),s={id:a,role:"assistant",content:"",timestamp:new Date};n(e=>[...e,r,s]),o(""),u(!0);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,userId:v.id})});if(!e.ok)throw Error("Failed to get response");let r=await e.json();n(e=>e.map(e=>e.id===a?{...e,content:r.response}:e))}catch(e){console.error("Error sending message:",e),n(e=>e.map(e=>e.id===a?{...e,content:"Sorry, I encountered an error. Please try again."}:e))}finally{u(!1)}};return t?(0,a.jsx)("div",{className:"fixed bottom-24 right-6 z-40",children:(0,a.jsxs)("div",{className:"\n        bg-[var(--card)] border border-[var(--border)] rounded-lg shadow-xl\n        transition-all duration-300 ease-in-out\n        ".concat(h?"w-80 h-16":"w-96 h-[500px]","\n      "),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-[var(--border)]",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-[var(--accent-blue)] rounded-full flex items-center justify-center",children:(0,a.jsx)(D.A,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("span",{className:"font-medium text-sm",children:"SAFe AI Assistant"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:()=>f(!h),className:"h-6 w-6 p-0 hover:bg-[var(--muted)]",children:(0,a.jsx)($.A,{className:"h-3 w-3"})}),(0,a.jsx)(m.$,{variant:"ghost",size:"sm",onClick:r,className:"h-6 w-6 p-0 hover:bg-[var(--muted)]",children:(0,a.jsx)(d.A,{className:"h-3 w-3"})})]})]}),!h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 h-[360px]",children:[s.map(e=>(0,a.jsxs)("div",{className:"flex space-x-2 ".concat("user"===e.role?"justify-end":"justify-start"),children:["assistant"===e.role&&(0,a.jsx)("div",{className:"w-6 h-6 bg-[var(--accent-blue)] rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:(0,a.jsx)(D.A,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{className:"max-w-[75%] p-3 rounded-lg text-sm ".concat("user"===e.role?"bg-[var(--primary-green)] text-white":"bg-[var(--muted)] border border-[var(--border)]"),children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.content}),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),"user"===e.role&&(0,a.jsx)("div",{className:"w-6 h-6 bg-[var(--primary-green)] rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:(0,a.jsx)(R.A,{className:"w-4 h-4 text-white"})})]},e.id)),c&&(0,a.jsxs)("div",{className:"flex space-x-2 justify-start",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-[var(--accent-blue)] rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:(0,a.jsx)(D.A,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("div",{className:"max-w-[75%] p-3 rounded-lg bg-[var(--muted)] border border-[var(--border)]",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 border-2 border-[var(--primary-green)] border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{className:"text-sm",children:"Analyzing..."})]})})]}),(0,a.jsx)("div",{ref:p})]}),(0,a.jsx)("div",{className:"p-4 border-t border-[var(--border)]",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(x.p,{value:l,onChange:e=>o(e.target.value),placeholder:"Ask about SAFe practices...",onKeyDown:e=>"Enter"===e.key&&!c&&g(),className:"flex-1 text-sm",disabled:c}),(0,a.jsx)(m.$,{onClick:()=>g(),disabled:c||!l.trim(),size:"sm",className:"px-3",children:(0,a.jsx)(B.A,{className:"w-3 h-3"})})]})})]})]})}):null}function J(e){let{children:t}=e,r=(0,s.usePathname)(),[n,l]=(0,i.useState)(!1);return(0,a.jsxs)("div",{className:"main-layout-container bg-[var(--background)]",children:[(0,a.jsx)(A,{}),(0,a.jsxs)("div",{className:"main-content-area",children:[(0,a.jsx)(P,{}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:t})]}),"/chat"!==r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M,{onClick:()=>l(!n),isOpen:n}),(0,a.jsx)(O,{isOpen:n,onClose:()=>l(!1)})]})]})}},7675:(e,t,r)=>{r.d(t,{W:()=>i});var a=r(6648);class s{async getDocuments(e,t){let r=this.supabase.from("documents").select("*").eq("user_id",e).order("updated_at",{ascending:!1});r=t?r.eq("folder_id",t):r.is("folder_id",null);let{data:a,error:s}=await r;if(s)throw Error("Failed to fetch documents: ".concat(s.message));return a}async getDocument(e,t){let{data:r,error:a}=await this.supabase.from("documents").select("*").eq("id",e).eq("user_id",t).single();if(a)throw Error("Failed to fetch document: ".concat(a.message));return r}async createDocument(e){let{data:t,error:r}=await this.supabase.from("documents").insert(e).select().single();if(r)throw Error("Failed to create document: ".concat(r.message));return t}async updateDocument(e,t,r){let{data:a,error:s}=await this.supabase.from("documents").update(t).eq("id",e).eq("user_id",r).select().single();if(s)throw Error("Failed to update document: ".concat(s.message));return a}async deleteDocument(e,t){let{data:r,error:a}=await this.supabase.from("documents").select("file_url").eq("id",e).eq("user_id",t).single();if(a)throw Error("Failed to fetch document for deletion: ".concat(a.message));let s=r.file_url.split("/").slice(-2).join("/"),{error:i}=await this.supabase.storage.from("documents").remove([s]);i&&console.warn("Failed to delete file from storage:",i.message);let{error:n}=await this.supabase.from("documents").delete().eq("id",e).eq("user_id",t);if(n)throw Error("Failed to delete document: ".concat(n.message));return{success:!0}}async searchDocuments(e,t,r){let a=this.supabase.from("documents").select("*").eq("user_id",e);t&&(a=a.or("title.ilike.%".concat(t,"%,content.ilike.%").concat(t,"%"))),r&&(r.artifactType&&(a=a.eq("artifact_type",r.artifactType)),r.priority&&(a=a.eq("priority",r.priority)),r.folderId&&(a=a.eq("folder_id",r.folderId)),r.tags&&r.tags.length>0&&(a=a.overlaps("tags",r.tags))),a=a.order("updated_at",{ascending:!1});let{data:s,error:i}=await a;if(i)throw Error("Failed to search documents: ".concat(i.message));return s}async getDocumentsByTag(e,t){let{data:r,error:a}=await this.supabase.from("documents").select("*").eq("user_id",e).contains("tags",[t]).order("updated_at",{ascending:!1});if(a)throw Error("Failed to fetch documents by tag: ".concat(a.message));return r}async getDocumentsByArtifactType(e,t){let{data:r,error:a}=await this.supabase.from("documents").select("*").eq("user_id",e).eq("artifact_type",t).order("updated_at",{ascending:!1});if(a)throw Error("Failed to fetch documents by artifact type: ".concat(a.message));return r}async updateDocumentTags(e,t,r){return this.updateDocument(e,{tags:t},r)}async updateDocumentArtifactType(e,t,r){return this.updateDocument(e,{artifact_type:t},r)}async updateDocumentPriority(e,t,r){return this.updateDocument(e,{priority:t},r)}async moveDocumentToFolder(e,t,r){return this.updateDocument(e,{folder_id:t},r)}async getDocumentStats(e){let{data:t,error:r}=await this.supabase.from("documents").select("artifact_type, priority, file_type").eq("user_id",e);if(r)throw Error("Failed to fetch document stats: ".concat(r.message));let a={total:t.length,byArtifactType:{},byPriority:{},byFileType:{}};return t.forEach(e=>{e.artifact_type&&(a.byArtifactType[e.artifact_type]=(a.byArtifactType[e.artifact_type]||0)+1),e.priority&&(a.byPriority[e.priority]=(a.byPriority[e.priority]||0)+1),a.byFileType[e.file_type]=(a.byFileType[e.file_type]||0)+1}),a}constructor(){this.supabase=(0,a.S)()}}let i=new s}}]);